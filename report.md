# **Отчет о выполнении Домашнего задания №1**
## *Выполнил* Шатравка Даниил Алексанрович БПИ212
## *Вариант 15*

---
Программа получает строку и выводит сообщение "YES" соответствующим способом, если строка является полиндромом, и "NO" в противном случае.

# На 4 балла
### Привести решение на языке C
Решение представленно в файлах находящихся в [папке](./C_files/):
- [Основной файл](./C_files/main.c)
- [Ввод из файла](./C_files/fileReader.c)
- [Вывод в файл](./C_files/fileWriter.c)
- [Генератор строки](./C_files/randomGenerator.c)
- [Проверка на плонидром](./C_files/polindromChecker.c)

### Комментарии в ассемблер
В ассемблер-файлах написаны комметарии, представляющие описание комманд ассемблера.
Файлы находится в [папке](./Assembler_files_reg/):
- [Ассемблер-код основного файла](./Assembler_files/main.s)
- [Ассемблер-код ввода из файла](./Assembler_files/fileReader.s)
- [Ассемблер-код вывода в файл](./Assembler_files/fileWriter.s)
- [Ассемблер-код генератора строки](./Assembler_files/randomGenerator.s)
- [Ассемблер-код проверки на полиндром](./Assembler_files/polindromChecker.s)

### Компиляция 
Программа была откомпелированна с помощью флагов:
```
gcc -masm=intel \
    -fno-asynchronous-unwind-tables \
    -fno-jump-tables \
    -fno-stack-protector \
    -fno-exceptions \
    ./code.c \
    -S -o ./code.s
```

Файлы собраны в объектные:

`gcc ./main.c -c -o ./main.o`

Линковка программы:

`gcc ./fill.o ./out.o ./genArr.o main.o -o prog.exe`

Для удобства компиляции был написан [bash скрипт](Bash_scripts/compileFromC.sh)

[Итоговый файл](./Executable_files/program)

### Тесты
Тестовое покрытие находится в [папке тестов](./Test/)

Входные данные имеют расширение **.in**

Выходные данные имеют расширение **.out**

Результаты тестовых прогонов совпали с ожидаемыми выходными данными.

---

# На 5 баллов 

## Функции с передачей данных:
в программе реализовано 4 функции с передачей данных:
```
GenerateRandomString(char* str, int len);
IsPolidrom(char* str, int len);
ReadFromFile(char* str, char* filename);
WriteToFile(char* str, char* filename);
```

## Локальные переменные
В коде функций используются локальные переменные:

```
// main
char str[MAX_SIZE];
clock_t t;
int len, amount_of_tests = 1;
char *inputFile = NULL, *outputFile = NULL;

// file writter readers
FILE* file
```

## Передача параметров
В комментариях к [ассемблер-файлам](#комментарии-в-ассемблер) добавлена информация о передаче параметров через регистры.

---

# На 6 баллов
## Использование регистров процессора
Переменные, которые раньше находились на стеке, перемещены на регистры процессора.

### Изменения в main.s
` DWORD PTR -64[rbp] -> r14d`

` QWORD PTR -96[rbp] -> r15`

Данное изменение уменьшит количество запросов на стек, что уменьшит время работы программы.

Тестовые прогоны совпадают с рузультатами тестовых прогонов до выполнения рефакторинга.

Результаты тестовых прогонов находятся в [данной папке](./Test/test_out_after_ref/).


### Изменение размера объектного файла main.o
$2460 kb => 2448$     

Замер производился с помощью команды `command time -v ./Executable_files/program`

# На 7 баллов

### Единицы компиляции
Программа скомпилирована с использованим [5 единиц компиляции](#комментарии-в-ассемблер).

### Задание файла с входными и выходными данными
Для работы с файлами нужно передать из имена в командную строку при запуске.

Если передан один параметр, то ввод будет выполнен из файла, а вывод осуществлен в консоль. Если передано 2 параметра то ввод и вывод будут осуществляться в соответствующие файлы.

# На 8 баллов
## Использование генератора случайных значений
Генератор случайных значений представлен в [основном файле](./C_files/main.c) и [файле генерации строки](./C_files/randomGenerator.c).

Для активации генератора, нужно запустить программу без аргументов, представляющих собой входнойи выходной файлы.

## Замеры времени
По окончании работы программа выводит время потраченное на работу.
Для произведения замеров с неоднократным вызовом функции в программу пожно передать параметр количества запусков с флагом -r. 

| Количество вызово `IsPolindrom()`     | Время работы, ms  |
| :---        |    :----:   |
| $1$      | 1       |
| $10$ | 1       |
| $10^5$  | 238       |
| $10^6$  | 2529       |


# На 9 баллов

Вариации программы находятся [здесь](./Optimithations/).

| Параметр оптимизации     | Время работы, ms  | Занимаемая память, kb|
| :---        |    :----:   |   :----: |
| O0      | 270 | 1064    |
| O1 | 194  |   968 |
| O2  | 167 | 948 |
| O3  | 171 |   948   |
| Ofast  | 299 |   912   |
| Ofast  | 773 |  944   |

Все тексты проводились с параметром $-r = 10^5$